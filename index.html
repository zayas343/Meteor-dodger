
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Astro Dodger</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    font-family: Arial, sans-serif;
}
canvas {
    display: block;
}
#menu {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 10;
}
button {
    padding: 8px 12px;
    margin: 3px;
    font-size: 14px;
}
#customization {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 10px;
    display: none;
    z-index: 20;
}
</style>
</head>
<body>

<div id="menu">
    <button onclick="toggleCustomization()">⚙️</button>
</div>

<div id="customization">
    <h3>Customize</h3>
    <div id="skins"></div>
    <div id="backgrounds"></div>
</div>

<canvas id="game"></canvas>

<script>
window.onload = function() {

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let gravity = 0.5;
let velocity = 0;

let spaceship = {
    x: canvas.width / 4,
    y: canvas.height / 2,
    size: 30
};

let asteroids = [];
let score = 0;
let level = 1;
let gameOver = false;

let unlockedSkins = JSON.parse(localStorage.getItem("skins")) || ["cyan"];
let unlockedBackgrounds = JSON.parse(localStorage.getItem("bgs")) || ["black"];

let currentSkin = localStorage.getItem("currentSkin") || "cyan";
let currentBackground = localStorage.getItem("currentBg") || "black";

function randomColor() {
    return `hsl(${Math.random()*360},70%,60%)`;
}

function spawnAsteroid() {
    let y = Math.random() * (canvas.height - 100) + 50;
    asteroids.push({
        x: canvas.width,
        y: y,
        size: 25,
        passed: false
    });
}

setInterval(spawnAsteroid, 1500);

function drawSpaceship() {
    ctx.fillStyle = currentSkin;
    ctx.beginPath();
    ctx.moveTo(spaceship.x, spaceship.y);
    ctx.lineTo(spaceship.x - 20, spaceship.y + 10);
    ctx.lineTo(spaceship.x - 20, spaceship.y - 10);
    ctx.closePath();
    ctx.fill();
}

function drawAsteroids() {
    ctx.fillStyle = "gray";
    asteroids.forEach(a => {
        ctx.beginPath();
        ctx.arc(a.x, a.y, a.size, 0, Math.PI * 2);
        ctx.fill();
    });
}

function update() {
    if (gameOver) return;

    velocity += gravity;
    spaceship.y += velocity;

    asteroids.forEach(a => {
        a.x -= 4 + level * 0.1;

        if (a.x + a.size < spaceship.x && !a.passed) {
            score++;
            a.passed = true;

            if (score % 10 === 0) {
                level++;
                if (level % 10 === 0) {
                    let newSkin = randomColor();
                    unlockedSkins.push(newSkin);
                    localStorage.setItem("skins", JSON.stringify(unlockedSkins));
                }
                if (level % 15 === 0) {
                    let newBg = randomColor();
                    unlockedBackgrounds.push(newBg);
                    localStorage.setItem("bgs", JSON.stringify(unlockedBackgrounds));
                }
            }
        }

        if (
            Math.abs(spaceship.x - a.x) < a.size &&
            Math.abs(spaceship.y - a.y) < a.size
        ) {
            gameOver = true;
        }
    });

    if (spaceship.y > canvas.height || spaceship.y < 0) {
        gameOver = true;
    }

    asteroids = asteroids.filter(a => a.x > -50);
}

function drawUI() {
    ctx.fillStyle = "white";
    ctx.font = "20px Arial";
    ctx.fillText("Astro Dodger", 20, 30);
    ctx.fillText("Score: " + score, 20, 60);
    ctx.fillText("Level: " + Math.min(level, 999), 20, 90);

    if (gameOver) {
        ctx.font = "40px Arial";
        ctx.fillText("GAME OVER", canvas.width/2 - 120, canvas.height/2);
        ctx.font = "20px Arial";
        ctx.fillText("Tap to Restart", canvas.width/2 - 70, canvas.height/2 + 40);
    }
}

function gameLoop() {
    ctx.fillStyle = currentBackground;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    update();
    drawSpaceship();
    drawAsteroids();
    drawUI();

    requestAnimationFrame(gameLoop);
}

canvas.addEventListener("touchstart", flap);
canvas.addEventListener("mousedown", flap);

function flap() {
    if (gameOver) {
        location.reload();
    }
    velocity = -9;
}

window.toggleCustomization = function() {
    let panel = document.getElementById("customization");
    panel.style.display = panel.style.display === "none" ? "block" : "none";
    renderCustomization();
}

function renderCustomization() {
    let skinsDiv = document.getElementById("skins");
    let bgDiv = document.getElementById("backgrounds");

    skinsDiv.innerHTML = "<h4>Skins</h4>";
    unlockedSkins.forEach(color => {
        skinsDiv.innerHTML += `<button style="background:${color}" onclick="selectSkin('${color}')">${color}</button>`;
    });

    bgDiv.innerHTML = "<h4>Backgrounds</h4>";
    unlockedBackgrounds.forEach(color => {
        bgDiv.innerHTML += `<button style="background:${color}" onclick="selectBg('${color}')">${color}</button>`;
    });
}

window.selectSkin = function(color) {
    currentSkin = color;
    localStorage.setItem("currentSkin", color);
}

window.selectBg = function(color) {
    currentBackground = color;
    localStorage.setItem("currentBg", color);
}

gameLoop();

};
</script>

</body>
</html>
